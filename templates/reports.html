{% extends "base.html" %}
{% block title %}B√°o c√°o{% endblock %}
{% block content %}
<h3 class="mb-3">B√°o c√°o üìä</h3>
<form class="row g-2 mb-3">
  <div class="col-md-4"><label class="form-label">T·ª´ ng√†y</label><input type="date" name="from" class="form-control" value="{{ request.args.get('from','') }}"></div>
  <div class="col-md-4"><label class="form-label">ƒê·∫øn ng√†y</label><input type="date" name="to" class="form-control" value="{{ request.args.get('to','') }}"></div>
  <div class="col-md-4"><label class="form-label">&nbsp;</label><button class="btn btn-outline-primary d-block w-100">L·ªçc</button></div>
</form>
<div class="row g-3 mb-3">
  <div class="col-md-4"><div class="card shadow-sm"><div class="card-body"><div class="fw-semibold">Gi√° v·ªën</div><div class="display-6">{{ "%.2f"|format(total_cost or 0) }}</div></div></div></div>
  <div class="col-md-4"><div class="card shadow-sm"><div class="card-body"><div class="fw-semibold">Doanh thu</div><div class="display-6">{{ "%.2f"|format(total_rev or 0) }}</div></div></div></div>
  <div class="col-md-4"><div class="card shadow-sm"><div class="card-body"><div class="fw-semibold">L·ª£i nhu·∫≠n</div><div class="display-6">{{ "%.2f"|format(total_profit or 0) }}</div></div></div></div>
</div>
<div class="card shadow-sm">
  <div class="card-header fw-semibold">Chi ti·∫øt xu·∫•t thu·ªëc (FIFO)</div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead><tr><th>Ng√†y</th><th>Visit</th><th>Thu·ªëc</th><th>L√¥</th><th>SL</th><th>Gi√° v·ªën</th><th>Gi√° b√°n</th><th>L·ª£i nhu·∫≠n</th></tr></thead>
        <tbody>
          {% for d in rows %}
          <tr>
            <td>{{ d.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>#{{ d.visit_id }}</td>
            <td>{{ d.medicine.name }}</td>
            <td>{{ d.lot.lot_no if d.lot else '-' }}</td>
            <td>{{ d.qty }}</td>
            <td>{{ "%.2f"|format(d.unit_cost) }}</td>
            <td>{{ "%.2f"|format(d.unit_price) }}</td>
            <td>{{ "%.2f"|format((d.unit_price-d.unit_cost)*d.qty) }}</td>
          </tr>
          {% else %}
          <tr><td colspan="8" class="text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
