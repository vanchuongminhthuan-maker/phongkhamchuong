{% extends "base.html" %}
{% block title %}Kho thu·ªëc{% endblock %}
{% block content %}
<h3 class="mb-3">Kho thu·ªëc üíä</h3>
<div class="row g-4">
  <div class="col-lg-5">
    <div class="card shadow-sm">
      <div class="card-header fw-semibold">Th√™m thu·ªëc</div>
      <div class="card-body">
        <form class="row g-2" method="post" action="/inventory/add_medicine">
          <div class="col-12">
            <label class="form-label">T√™n thu·ªëc *</label>
            <input name="name" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">D·∫°ng</label>
            <input name="form" class="form-control" placeholder="vi√™n/g√≥i/l·ªç/chai/·ªëng ti√™m...">
          </div>
          <div class="col-md-6">
            <label class="form-label">ƒê∆°n v·ªã t√≠nh</label>
            <input name="unit" class="form-control" placeholder="vi√™n/h·ªôp/chai...">
          </div>
          <div class="col-12"><button class="btn btn-outline-primary mt-2">Th√™m thu·ªëc</button></div>
        </form>
      </div>
    </div>
    <div class="card shadow-sm mt-3">
      <div class="card-header fw-semibold">Nh·∫≠p kho (l√¥)</div>
      <div class="card-body">
        <form class="row g-2" method="post" action="/inventory/add_lot">
          <div class="col-12">
            <label class="form-label">Thu·ªëc</label>
            <select name="medicine_id" class="form-select">
              {% for m in meds %}<option value="{{ m.id }}">{{ m.name }} ({{ m.form or '-' }})</option>{% endfor %}
            </select>
          </div>
          <div class="col-md-6"><label class="form-label">S·ªë l√¥</label><input name="lot_no" class="form-control"></div>
          <div class="col-md-6"><label class="form-label">Ng√†y nh·∫≠p</label><input type="date" name="received_date" class="form-control"></div>
          <div class="col-md-6"><label class="form-label">H·∫°n d√πng</label><input type="date" name="expiry_date" class="form-control"></div>
          <div class="col-md-6"><label class="form-label">S·ªë l∆∞·ª£ng nh·∫≠p</label><input type="number" name="qty_in" class="form-control" min="1" value="1" required></div>
          <div class="col-md-6"><label class="form-label">Ch·∫ø ƒë·ªô gi√°</label><select name="price_mode" class="form-select"><option value="unit">Nh·∫≠p ƒë∆°n gi√°</option><option value="total">Nh·∫≠p gi√° t·ªïng</option></select></div>
          <div class="col-md-6"><label class="form-label">Gi√° (ƒë∆°n gi√° ho·∫∑c t·ªïng)</label><input type="number" step="0.01" name="price" class="form-control" min="0" value="0"></div>
          <div class="col-12"><button class="btn btn-success mt-2">Nh·∫≠p kho</button></div>
        </form>
      </div>
    </div>
  </div>
  <div class="col-lg-7">
    <div class="card shadow-sm">
      <div class="card-header fw-semibold">Danh s√°ch kho hi·ªán t·∫°i</div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead><tr><th>#</th><th>T√™n thu·ªëc</th><th>D·∫°ng</th><th>L√¥</th><th>H·∫°n d√πng</th><th>T·ªìn</th><th>Gi√° v·ªën TB*</th></tr></thead>
            <tbody>
              {% for row in lots %}
              {% set lot = row[0] %}
              <tr>
                <td>{{ lot.id }}</td>
                <td>{{ row.med_name }}</td>
                <td>{{ row.med_form or '-' }}</td>
                <td>{{ lot.lot_no or '-' }}</td>
                <td>{% if lot.expiry_date %}{{ lot.expiry_date.strftime('%Y-%m-%d') }}{% else %}-{% endif %}</td>
                <td>{{ lot.qty_remaining }}</td>
                <td>{{ "%.2f"|format(lot.unit_cost or 0) }}</td>
              </tr>
              {% else %}
              <tr><td colspan="7" class="text-muted">Ch∆∞a c√≥ l√¥ n√†o.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="form-text">* ·ªû c·∫•p l√¥, ‚Äúgi√° v·ªën TB‚Äù ch√≠nh l√† ƒë∆°n gi√° nh·∫≠p c·ªßa l√¥.</div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
